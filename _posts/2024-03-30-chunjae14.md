---
layout: post
title:  "천재교육 빅데이터 7기 강의 정리 -14"
excerpt: "천재교육 14"

tags:
  - [Blog, jekyll, Github, Python, 천재교육, 빅데이터, SQL, 데이터분석, 데이터 분석, 이상치, 결측치, 모델링, 머신러닝, 기계학습]

toc: true
toc_sticky: true

date: 2024-03-30
last_modified_at: 2024-03-30
---

{% include toc.html %}

### 3월 29일 강의 정리
[깃허브 링크1](https://github.com/gustjr7879/chunjae/blob/main/jae24.sql)      
[깃허브 링크1](https://github.com/gustjr7879/chunjae/blob/main/jae25.sql)
### SQL
SQL을 배웠다. MySQL을 알긴 하지만 실제 데이터 베이스를 가지고 직접 돌리면서 확인해보는 경험은 또 새로웠다.    
또 PostgreSQL도 같이 배워서 좀 재미있었다.    
사실 SQL을 배우면서 어떤 문법이 어떤 기능을 가지고 있는지를 보고 어느 상황에서 사용이 되는지 위주로 알게되었고 어느정도 문법이 익자마자 어려운(?) 과제를 내주셔서 그거 하느라고 시간이 다 갔다.    
문법은 위에 2개 링크를 타고 들어가면 확인할 수 있고 나름대로 복습도 계속 하고 있고 좀 방대하다 보니까 여기에서 정리하진 않겠다.      
이 글에서는 하면서 이해가 좀 안되었던 부분이나, 과제를 하면서 어려웠던 부분을 작성하고자 한다.    

모든 실습은 AWS Athena 기준으로 작성되었음을 참고하면 좋다. 문법이 살짝씩 다르지만 거의 비슷하기 때문에 실습하기엔 최고였다.

#### Select는 단독으로도 사용할 수 있다.
파이썬에 print가 있다면 SQL에는 select문이 있다. 사실 해당되는 조건에 맞는 것을 보여준다가 맞지만 from과 같이 안작성해도 된다는 것이다.     
나는 몰랐기 때문에 적는다 ㅎㅎ..   

#### SQL의 리스트
여러가지 언어에서 배열이나 리스트는 [] 으로 표현한다. 하지만 SQL에서는 ()으로 표기하는 것을 알아두자.     

#### Limit 꼭 걸어두기
데이터가 커지면 커질수록 모든 것을 조회하려고 하면 시간이 오래걸리기 마련이다. 따라서 꼭 limit를 걸어둬서 내 코드가 완벽하게 돌아가는지 파악하도록 하자.     

#### trim
SQL에는 trim이라는 공백 제거 방법이 있다. 이것을 사용해서 어느 열에서 이상한 값을 깔끔하게 만들어줄 수 있다.    
오류나 사람의 실수로 공백이 들어간 경우 정규화 해주는 것이라고 생각하면 편하다.     

#### group by를 사용하는 이유
SQL에는 group by를 사용해서 합칠 수 있다.    
생각해보면 distinct를 사용해서 합쳐버리면 되는거 아닌가? 할 수 있지만 group by를 사용하면 집계 함수를 사용할 수 있다.    
생일이 10월 6일인 사람들의 '평균'나이 이런 식으로 말이다.     

#### 별명을 지정해주는 as
어떤 값이나, 변수, 열 이름 등을 as로 표현해줄 수 있다. 별칭을 해주는데 생각보다 많이 사용하고 없으면 쿼리가 잘 안돌아가는 경우도 존재한다.    

#### 변수를 선언해주는 with - as
with 변수명 as () 로 여러개의 기능을 한데 모아 하나의 쿼리로 설정할 수 있다.    
이번 과제 또한 여러가지 기능을 모아야 했기 때문에 with을 사용했고 생각보다 훨씬 편리한 기능이라는 것을 깨달았다. (눈이 피곤하긴함 ㅋ)      

#### 과제 중 힘들었던 부분
과제는 위의 링크 중 밑에 링크에 들어가서 밑에 부분이 내가 한 과제가 적혀져있다.    
위에는 postgreSQL이랑 dbeaver에서 연습한 내용이고 -- 조건 ##### 으로 되어있는 부분이 내가 과제를 진행한 부분이다.    
과제를 처음 보고 여러가지 테이블을 지지고 볶아서 만들어야된다는 것을 느꼈다.     
생각보다 복잡해질 것 같기 때문에 나는 필터링 하는 형식으로 만들어서 조건 1을 만족하는 테이블, 조건 2를 만족하는 테이블, 조건 3을 만족하는 테이블 을 만들고      
조건 1 + 2 를 만족하는 테이블, 그리고 이 테이블과 3을 만족하는 테이블과 합치고 .... 그룹화하고 ..... 집계하고 .....    
형식으로 진행했다.     
하나의 테이블에서 같은 아이디가 중복으로 되어있길래 grade가 가장 높은 것으로 대체해서 뽑아버렸다 (가장 최근거가 진짜지 ~ 라는 느낌으로)     

이렇게 전반적으로 처리를 끝내고 이제 요구사항을 만족시켜야했다.     
요구사항을 만족시키려면 꼭 테이블을 조인해야했고 테이블에 있는 데이터의 수가 천만개 이상이였기 때문에 그냥 조인하면 큰일난다는 것을 깨달았다.    
따라서 다시 위로 올라가서 테이블을 처음 만들 때 join을 사용했던 것을 다 뜯어 고쳤다. join은 간편하고 직관적이지만 그만큼 시간이 너무 오래 걸렸기 때문이다.     
그래서 조건을 만족하는 초기 테이블을 만들 때 최대한 빠르게 해야했고 join을 사용하면 안된다고 생각했다.     
따라서 select를 서브쿼리로 넣어서 join대신 사용했고, 결과적으로는 상당히 속도가 빨라졌다.      
그래서 github 커밋내용에 join의 함정에 빠지지 말자고 적었다.     
나머지 집계를 해야하는 부분은 join을 사용했고 그때는 이미 테이블의 숫자가 많이 줄어있었기 때문에 무리없이 진행되었다.    

데이터 베이스가 깔끔하지 못하거나 데이터에 대한 이해도가 떨어지면 헤맬수도 있다는 것을 깨달았고 데이터의 숫자가 크면 클수록 머리를 돌돌돌 잘 굴려야한다는 것도 깨달았다.    
또 내가 편하자고 맘대로 사용하면 힘들다는 것도 ㅎ,, 문법이 이제 많이 익었으니까 계속해서 해보면서 까먹지 않게 유지할 예정이다.     
나중에 어디에 취업을 하던지 내가 필요로하는 데이터는 내가 편하게 꺼내서 가공하고 처리할 수 있어야 될 것 같기 때문이다.     


ps -> SQL 문법 통일좀 ;